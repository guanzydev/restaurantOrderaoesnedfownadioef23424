(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2518:(e,t,r)=>{Promise.resolve().then(r.bind(r,6485)),Promise.resolve().then(r.bind(r,4785)),Promise.resolve().then(r.bind(r,9271))},4785:(e,t,r)=>{"use strict";r.d(t,{EventProvider:()=>s,_:()=>c});var n=r(5155),o=r(2115),i=r(1368);let a=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[r,s]=(0,o.useState)([]);function c(e,t,r){let n=r.event_id||(0,i.A)();s(o=>[...o,{id:n,direction:e,eventName:t,eventData:r,timestamp:new Date().toLocaleTimeString(),expanded:!1}])}return(0,n.jsx)(a.Provider,{value:{loggedEvents:r,logClientEvent:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c("client","".concat(e.type||""," ").concat(t||"").trim(),e)},logServerEvent:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c("server","".concat(e.type||""," ").concat(t||"").trim(),e)},logHistoryItem:e=>{let t=e.type;"message"===e.type&&(t="".concat(e.role,".").concat(e.status)),"function_call"===e.type&&(t="function.".concat(e.name,".").concat(e.status)),c("server",t,e)},toggleExpand:e=>{s(t=>t.map(t=>t.id===e?{...t,expanded:!t.expanded}:t))}},children:t})};function c(){let e=(0,o.useContext)(a);if(!e)throw Error("useEvent must be used within an EventProvider");return e}},6485:(e,t,r)=>{"use strict";r.d(t,{default:()=>Q});var n=r(5155),o=r(2115),i=r(5695),a=r(1368),s=r(6766),c=r(792),l=r(9271),d=r(3096);function u(e){let t,r,i,{guardrailResult:a}=e,[s,c]=(0,o.useState)(!1),l="IN_PROGRESS"===a.status?"PENDING":"NONE"===a.category?"PASS":"FAIL";switch(l){case"PENDING":default:t=d.O4,r="Pending",i="text-gray-600";break;case"PASS":t=d.KaV,r="Pass",i="text-green-600";break;case"FAIL":t=d._cW,r="Fail",i="text-red-500"}return(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsxs)("div",{onClick:()=>{"PENDING"!==l&&c(!s)},className:"inline-flex items-center gap-1 rounded ".concat("PENDING"!==l?"cursor-pointer":""),children:["Guardrail:",(0,n.jsxs)("div",{className:"flex items-center gap-1 ".concat(i),children:[(0,n.jsx)(t,{})," ",r]})]}),"PENDING"!==l&&a.category&&a.rationale&&(0,n.jsx)("div",{className:"overflow-hidden transition-all duration-300 ".concat(s?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:(0,n.jsxs)("div",{className:"pt-2 text-xs",children:[(0,n.jsxs)("strong",{children:["Moderation Category: ",a.category.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")]}),(0,n.jsx)("div",{children:a.rationale}),a.testText&&(0,n.jsx)("blockquote",{className:"mt-1 border-l-2 border-gray-300 pl-2 text-gray-400",children:a.testText})]})})]})}let m=function(e){let{userText:t,setUserText:r,onSendMessage:i,canSend:a,downloadRecording:m}=e,{transcriptItems:p,toggleTranscriptItemExpand:h}=(0,l.c)(),g=(0,o.useRef)(null),[y,f]=(0,o.useState)([]),[x,v]=(0,o.useState)(!1),b=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=p.length>y.length,t=p.some((e,t)=>{let r=y[t];return r&&(e.title!==r.title||e.data!==r.data)});(e||t)&&g.current&&(g.current.scrollTop=g.current.scrollHeight),f(p)},[p]),(0,o.useEffect)(()=>{a&&b.current&&b.current.focus()},[a]);let S=async()=>{if(g.current)try{await navigator.clipboard.writeText(g.current.innerText),v(!0),setTimeout(()=>v(!1),1500)}catch(e){console.error("Failed to copy transcript:",e)}};return(0,n.jsxs)("div",{className:"flex flex-col flex-1 bg-white min-h-0 rounded-xl",children:[(0,n.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 sticky top-0 z-10 text-base border-b bg-white rounded-t-xl",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Transcript"}),(0,n.jsxs)("div",{className:"flex gap-x-2",children:[(0,n.jsxs)("button",{onClick:S,className:"w-24 text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300 flex items-center justify-center gap-x-1",children:[(0,n.jsx)(d.DDb,{}),x?"Copied!":"Copy"]}),(0,n.jsxs)("button",{onClick:m,className:"w-40 text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300 flex items-center justify-center gap-x-1",children:[(0,n.jsx)(d.s3U,{}),(0,n.jsx)("span",{children:"Download Audio"})]})]})]}),(0,n.jsx)("div",{ref:g,className:"overflow-auto p-4 flex flex-col gap-y-4 h-full",children:[...p].sort((e,t)=>e.createdAtMs-t.createdAtMs).map(e=>{let{itemId:t,type:r,role:o,data:i,expanded:a,timestamp:s,title:l="",isHidden:d,guardrailResult:m}=e;if(d)return null;if("MESSAGE"===r){let e="user"===o,r=l.startsWith("[")&&l.endsWith("]"),i=r?l.slice(1,-1):l;return(0,n.jsx)("div",{className:"flex justify-end flex-col ".concat(e?"items-end":"items-start"),children:(0,n.jsxs)("div",{className:"max-w-lg",children:[(0,n.jsxs)("div",{className:"".concat("max-w-lg p-3 ".concat(e?"bg-gray-900 text-gray-100":"bg-gray-100 text-black")," rounded-t-xl ").concat(m?"":"rounded-b-xl"),children:[(0,n.jsx)("div",{className:"text-xs ".concat(e?"text-gray-400":"text-gray-500"," font-mono"),children:s}),(0,n.jsx)("div",{className:"whitespace-pre-wrap ".concat(r?"italic text-gray-400":""),children:(0,n.jsx)(c.oz,{children:i})})]}),m&&(0,n.jsx)("div",{className:"bg-gray-200 px-3 py-2 rounded-b-xl",children:(0,n.jsx)(u,{guardrailResult:m})})]})},t)}return"BREADCRUMB"===r?(0,n.jsxs)("div",{className:"flex flex-col justify-start items-start text-gray-500 text-sm",children:[(0,n.jsx)("span",{className:"text-xs font-mono",children:s}),(0,n.jsxs)("div",{className:"whitespace-pre-wrap flex items-center font-mono text-sm text-gray-800 ".concat(i?"cursor-pointer":""),onClick:()=>i&&h(t),children:[i&&(0,n.jsx)("span",{className:"text-gray-400 mr-1 transform transition-transform duration-200 select-none font-mono ".concat(a?"rotate-90":"rotate-0"),children:"▶"}),l]}),a&&i&&(0,n.jsx)("div",{className:"text-gray-800 text-left",children:(0,n.jsx)("pre",{className:"border-l-2 ml-1 border-gray-200 whitespace-pre-wrap break-words font-mono text-xs mb-2 mt-2 pl-2",children:JSON.stringify(i,null,2)})})]},t):(0,n.jsxs)("div",{className:"flex justify-center text-gray-500 text-sm italic font-mono",children:["Unknown item type: ",r," ",(0,n.jsx)("span",{className:"ml-2 text-xs",children:s})]},t)})})]}),(0,n.jsxs)("div",{className:"p-4 flex items-center gap-x-2 flex-shrink-0 border-t border-gray-200",children:[(0,n.jsx)("input",{ref:b,type:"text",value:t,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&i()},className:"flex-1 px-4 py-2 focus:outline-none",placeholder:"Type a message..."}),(0,n.jsx)("button",{onClick:i,disabled:!a||!t.trim(),className:"bg-gray-900 text-white rounded-full px-2 py-2 disabled:opacity-50",children:(0,n.jsx)(s.default,{src:"arrow.svg",alt:"Send",width:24,height:24})})]})]})};var p=r(4785);let h=function(e){let{isExpanded:t}=e,[r,i]=(0,o.useState)([]),a=(0,o.useRef)(null),{loggedEvents:s,toggleExpand:c}=(0,p._)(),l=e=>"client"===e?{symbol:"▲",color:"#7f5af0"}:"server"===e?{symbol:"▼",color:"#2cb67d"}:{symbol:"•",color:"#555"};return(0,o.useEffect)(()=>{let e=s.length>r.length;t&&e&&a.current&&(a.current.scrollTop=a.current.scrollHeight),i(s)},[s,t]),(0,n.jsx)("div",{className:(t?"w-1/2 overflow-auto":"w-0 overflow-hidden opacity-0")+" transition-all rounded-xl duration-200 ease-in-out flex-col bg-white",ref:a,children:t&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex items-center justify-between px-6 py-3.5 sticky top-0 z-10 text-base border-b bg-white rounded-t-xl",children:(0,n.jsx)("span",{className:"font-semibold",children:"Logs"})}),(0,n.jsx)("div",{children:s.map((e,t)=>{var r,o,i;let a=l(e.direction),s=e.eventName.toLowerCase().includes("error")||(null==(i=e.eventData)||null==(o=i.response)||null==(r=o.status_details)?void 0:r.error)!=null;return(0,n.jsxs)("div",{className:"border-t border-gray-200 py-2 px-6 font-mono",children:[(0,n.jsxs)("div",{onClick:()=>c(e.id),className:"flex items-center justify-between cursor-pointer",children:[(0,n.jsxs)("div",{className:"flex items-center flex-1",children:[(0,n.jsx)("span",{style:{color:a.color},className:"ml-1 mr-2",children:a.symbol}),(0,n.jsx)("span",{className:"flex-1 text-sm "+(s?"text-red-600":"text-gray-800"),children:e.eventName})]}),(0,n.jsx)("div",{className:"text-gray-500 ml-1 text-xs whitespace-nowrap",children:e.timestamp})]}),e.expanded&&e.eventData&&(0,n.jsx)("div",{className:"text-gray-800 text-left",children:(0,n.jsx)("pre",{className:"border-l-2 ml-1 border-gray-200 whitespace-pre-wrap break-words font-mono text-xs mb-2 mt-2 pl-2",children:JSON.stringify(e.eventData,null,2)})})]},"".concat(e.id,"-").concat(t))})})]})})},g=function(e){let{sessionStatus:t,onToggleConnection:r,isPTTActive:o,setIsPTTActive:i,isPTTUserSpeaking:a,handleTalkButtonDown:s,handleTalkButtonUp:c,isEventsPaneExpanded:l,setIsEventsPaneExpanded:d,isAudioPlaybackEnabled:u,setIsAudioPlaybackEnabled:m,codec:p,onCodecChange:h}=e,g="CONNECTED"===t,y="CONNECTING"===t;return(0,n.jsxs)("div",{className:"p-4 flex flex-row items-center justify-center gap-x-8",children:[(0,n.jsx)("button",{onClick:r,className:function(){let e="text-white text-base p-2 w-36 rounded-md h-full",t=y?"cursor-not-allowed":"cursor-pointer";return g?"bg-red-600 hover:bg-red-700 ".concat(t," ").concat(e):"bg-black hover:bg-gray-900 ".concat(t," ").concat(e)}(),disabled:y,children:g?"Disconnect":y?"Connecting...":"Connect"}),(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,n.jsx)("input",{id:"push-to-talk",type:"checkbox",checked:o,onChange:e=>i(e.target.checked),disabled:!g,className:"w-4 h-4"}),(0,n.jsx)("label",{htmlFor:"push-to-talk",className:"flex items-center cursor-pointer",children:"Push to talk"}),(0,n.jsx)("button",{onMouseDown:s,onMouseUp:c,onTouchStart:s,onTouchEnd:c,disabled:!o,className:(a?"bg-gray-300":"bg-gray-200")+" py-1 px-4 cursor-pointer rounded-md"+(o?"":" bg-gray-100 text-gray-400"),children:"Talk"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,n.jsx)("input",{id:"audio-playback",type:"checkbox",checked:u,onChange:e=>m(e.target.checked),disabled:!g,className:"w-4 h-4"}),(0,n.jsx)("label",{htmlFor:"audio-playback",className:"flex items-center cursor-pointer",children:"Audio playback"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,n.jsx)("input",{id:"logs",type:"checkbox",checked:l,onChange:e=>d(e.target.checked),className:"w-4 h-4"}),(0,n.jsx)("label",{htmlFor:"logs",className:"flex items-center cursor-pointer",children:"Logs"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,n.jsx)("div",{children:"Codec:"}),(0,n.jsxs)("select",{id:"codec-select",value:p,onChange:e=>{h(e.target.value)},className:"border border-gray-300 rounded-md px-2 py-1 focus:outline-none cursor-pointer",children:[(0,n.jsx)("option",{value:"opus",children:"Opus (48 kHz)"}),(0,n.jsx)("option",{value:"pcmu",children:"PCMU (8 kHz)"}),(0,n.jsx)("option",{value:"pcma",children:"PCMA (8 kHz)"})]})]})]})};var y=r(8634);function f(){let{transcriptItems:e,addTranscriptBreadcrumb:t,addTranscriptMessage:r,updateTranscriptMessage:n,updateTranscriptItem:i}=(0,l.c)(),{logServerEvent:a}=(0,p._)(),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e.map(e=>{var t,r;return e&&"object"==typeof e?"input_text"===e.type?null!=(t=e.text)?t:"":"audio"===e.type&&null!=(r=e.transcript)?r:"":""}).filter(Boolean).join("\n"):""},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Array.isArray(t))return t.find(t=>"function_call"===t.type&&t.name===e)},d=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){console.warn("Failed to parse JSON:",e)}return e},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(Array.isArray(e))return e.reverse().find(e=>"message"===e.type&&"assistant"===e.role)},m=e=>"moderationCategory"in e?e:"outputInfo"in e?m(e.outputInfo):"output"in e?m(e.output):"result"in e?m(e.result):void 0,h=e=>{var t;return null==(t=e.match(/Failure Details: (\{.*?\})/))?void 0:t[1]};return(0,o.useRef)({handleAgentToolStart:function(e,r,n){var o;let i=c(n.name,null==e||null==(o=e.context)?void 0:o.history),a=null==i?void 0:i.name,s=null==i?void 0:i.arguments;t("function call: ".concat(a),s)},handleAgentToolEnd:function(e,r,n,o){var i;let a=c(n.name,null==e||null==(i=e.context)?void 0:i.history);t("function call result: ".concat(null==a?void 0:a.name),d(o))},handleHistoryUpdated:function(e){console.log("[handleHistoryUpdated] ",e),e.forEach(e=>{if(!e||"message"!==e.type)return;let{itemId:t,content:r=[]}=e,o=s(r);o&&n(t,o,!1)})},handleHistoryAdded:function(e){if(console.log("[handleHistoryAdded] ",e),!e||"message"!==e.type)return;let{itemId:n,role:o,content:i=[]}=e;if(n&&o){let e="user"===o,a=s(i);e&&!a&&(a="[Transcribing...]");let c=h(a);c?t("Output Guardrail Active",{details:JSON.parse(c)}):r(n,o,a)}},handleTranscriptionDelta:function(e){let t=e.item_id,r=e.delta||"";t&&n(t,r,!0)},handleTranscriptionCompleted:function(t){let r=t.item_id,o=t.transcript&&"\n"!==t.transcript?t.transcript:"[inaudible]";if(r){var a;n(r,o,!1);let t=e.find(e=>e.itemId===r);i(r,{status:"DONE"}),(null==t||null==(a=t.guardrailResult)?void 0:a.status)==="IN_PROGRESS"&&i(r,{guardrailResult:{status:"DONE",category:"NONE",rationale:""}})}},handleGuardrailTripped:function(e,t,r){var n,o,s;console.log("[guardrail tripped]",e,t,r);let c=m(r.result.output.outputInfo);a({type:"guardrail_tripped",payload:c});let l=u(null==e||null==(n=e.context)?void 0:n.history);if(l&&c){let e=null!=(o=c.moderationCategory)?o:"NONE",t=null!=(s=c.moderationRationale)?s:"",r=null==c?void 0:c.testText;i(l.itemId,{guardrailResult:{status:"DONE",category:e,rationale:t,testText:r}})}}})}var x=r(5480),v=r(1153);let b=v.z.enum(["OFFENSIVE","OFF_BRAND","VIOLENCE","NONE"]),S=v.z.object({moderationRationale:v.z.string(),moderationCategory:b,testText:v.z.string().optional()});async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newTelco",r=[{role:"user",content:"You are an expert at classifying text according to moderation policies. Consider the provided message, analyze potential classes from output_classes, and output the best classification. Output json, following the provided schema. Keep your analysis and reasoning short and to the point, maximum 2 sentences.\n\n      <info>\n      - Company name: ".concat(t,"\n      </info>\n\n      <message>\n      ").concat(e,"\n      </message>\n\n      <output_classes>\n      - OFFENSIVE: Content that includes hate speech, discriminatory language, insults, slurs, or harassment.\n      - OFF_BRAND: Content that discusses competitors in a disparaging way.\n      - VIOLENCE: Content that includes explicit threats, incitement of harm, or graphic descriptions of physical injury or violence.\n      - NONE: If no other classes are appropriate and the message is fine.\n      </output_classes>\n      ")}],n=await fetch("/api/responses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",input:r,text:{format:(0,x.GX)(S,"output_format")}})});if(!n.ok)return console.warn("Server returned an error:",n),Promise.reject("Error with runGuardrailClassifier.");let o=await n.json();try{return{...S.parse(o.output_parsed),testText:e}}catch(e){return console.error("Error parsing the message content as GuardrailOutput:",e),Promise.reject("Failed to parse guardrail output.")}}let _={item_001:{name:"Chicken or Pork Chow",price:9.25,category:"Lunch Specials"},item_002:{name:"Baby Shrimp Chow Mei",price:9.25,category:"Lunch Specials"},item_003:{name:"Chicken or Pork Lo Mein Chicken",price:9.25,category:"Lunch Specials"},item_004:{name:"Roast Pork Egg Foo Young",price:9.25,category:"Lunch Specials"},item_005:{name:"Sweet & Sour Pork or Chicken Pork",price:9.25,category:"Lunch Specials"},item_006:{name:"Roast Pork with Chinese Vegetable",price:9.25,category:"Lunch Specials"},item_007:{name:"Beef with Chinese Vegetable",price:9.45,category:"Lunch Specials"},item_008:{name:"Moo Goo Gai Pan",price:9.25,category:"Lunch Specials"},item_009:{name:"Pepper Steak with Onion",price:9.45,category:"Lunch Specials"},item_010:{name:"Baby Shrimp with Lobster Sauce",price:9.45,category:"Lunch Specials"},item_011a:{name:"Chicken with Broccoli with White Rice",price:9.25,category:"Lunch Specials"},item_011b:{name:"Chicken with Broccoli with Fried Rice",price:9.25,category:"Lunch Specials"},item_012:{name:"Beef with Broccoli",price:9.45,category:"Lunch Specials"},item_013:{name:"Baby Shrimp with Broccoli",price:9.45,category:"Lunch Specials"},item_014:{name:"Saut\xe9ed Mixed Vegetables",price:8.95,category:"Lunch Specials"},item_015:{name:"Boneless Honey Ribs",price:9.75,category:"Lunch Specials"},item_016:{name:"Sesame Chicken",price:9.75,category:"Lunch Specials"},item_017:{name:"General Tso’s Chicken",price:9.75,category:"Lunch Specials"},item_018:{name:"Hot & Spicy Shrimp",price:9.75,category:"Lunch Specials"},item_019:{name:"Curry Chicken with Onion",price:9.25,category:"Lunch Specials"},item_020:{name:"Broccoli with Garlic Sauce",price:8.95,category:"Lunch Specials"},item_021:{name:"Chicken with Garlic Sauce",price:9.25,category:"Lunch Specials"},item_022:{name:"Beef with Garlic Sauce",price:9.45,category:"Lunch Specials"},item_023:{name:"Baby Shrimp with Garlic Sauce",price:9.45,category:"Lunch Specials"},item_024:{name:"Kung Po Chicken",price:9.25,category:"Lunch Specials"},item_025:{name:"Kung Po Baby Shrimp",price:9.45,category:"Lunch Specials"},item_026:{name:"Hunan Chicken",price:9.25,category:"Lunch Specials"},item_027:{name:"Hunan Beef",price:9.45,category:"Lunch Specials"},item_028:{name:"Hunan Shrimp",price:9.45,category:"Lunch Specials"},item_029:{name:"Kung Po Bean Curd",price:8.95,category:"Lunch Specials"},item_030:{name:"Fried Wings (4)",price:9.65,category:"Lunch Specials"},item_031:{name:"Spring Roll (2)",price:3.95,category:"Appetizers"},item_032:{name:"Roast Pork or Veggie Egg Roll",price:2.15,category:"Appetizers"},item_033:{name:"Shrimp Egg Roll (Each)",price:2.3,category:"Appetizers"},item_034:{name:"Roast Pork Slices (Sm)",price:7.5,category:"Appetizers"},item_035:{name:"Roast Pork Slices (Lg)",price:11.95,category:"Appetizers"},item_036:{name:"Boneless Honey Ribs (Sm)",price:10.25,category:"Appetizers"},item_037:{name:"Boneless Honey Ribs (Lg)",price:17.5,category:"Appetizers"},item_038:{name:"BBQ Spare Ribs (Sm)",price:10.5,category:"Appetizers"},item_039:{name:"BBQ Spare Ribs (Lg)",price:18.49,category:"Appetizers"},item_040:{name:"Golden Chicken Fingers (5)",price:7.25,category:"Appetizers"},item_041:{name:"Fried Wonton (10)",price:5.25,category:"Appetizers"},item_042:{name:"Chicken Wings (4)",price:8.25,category:"Appetizers"},item_043:{name:"Shrimp Toast (4 pcs)",price:5.25,category:"Appetizers"},item_044:{name:"Teriyaki Beef (2)",price:7.25,category:"Appetizers"},item_045:{name:"Teriyaki Chicken (2)",price:6.25,category:"Appetizers"},item_046:{name:"Cheese Wonton (8)",price:6.25,category:"Appetizers"},item_047:{name:"Steamed Dumplings (8)",price:6.99,category:"Appetizers"},item_048:{name:"Pan-Fried Dumplings (8)",price:6.99,category:"Appetizers"},item_049:{name:"Steamed Veggie Dumplings (8)",price:6.99,category:"Appetizers"},item_050:{name:"Pan-Fried Veggie Dumplings (8)",price:6.99,category:"Appetizers"},item_051:{name:"Shrimp Shumai (8)",price:8,category:"Appetizers"},item_052:{name:"Coconut Shrimp (6)",price:8,category:"Appetizers"},item_053:{name:"Tempura Shrimp (8)",price:8,category:"Appetizers"},item_054:{name:"Steamed Shrimp Dumpling (8)",price:8.99,category:"Appetizers"},item_055:{name:"Dumpling with Sesame Sauce (8)",price:7.95,category:"Appetizers"},item_056:{name:"Cold Sesame Noodles",price:6.75,category:"Appetizers"},item_057:{name:"Pu Pu Platter (For 2)",price:16.25,category:"Appetizers"},item_058:{name:"Edamame",price:4.95,category:"Appetizers"},item_059:{name:"Egg Drop Soup (Pt)",price:3.25,category:"Soup"},item_060:{name:"Egg Drop Soup (Qt)",price:5.75,category:"Soup"},item_061:{name:"Wonton Soup (Pt)",price:3.95,category:"Soup"},item_062:{name:"Wonton Soup (Qt)",price:6.5,category:"Soup"},item_063:{name:"Wonton Egg Drop Mix (Pt)",price:4.25,category:"Soup"},item_064:{name:"Wonton Egg Drop Mix (Qt)",price:6.5,category:"Soup"},item_065:{name:"Chicken Rice or Noodle (Pt)",price:4.25,category:"Soup"},item_066:{name:"Chicken Rice or Noodle (Qt)",price:6.5,category:"Soup"},item_067:{name:"Vegetable Soup (Pt)",price:4.75,category:"Soup"},item_068:{name:"Vegetable Soup (Qt)",price:6.75,category:"Soup"},item_069:{name:"Hot & Sour Soup (Pt)",price:4.75,category:"Soup"},item_070:{name:"Hot & Sour Soup (Qt)",price:6.75,category:"Soup"},item_071:{name:"Special Seafood Soup (For 2)",price:10.5,category:"Soup"},item_072:{name:"House Special Soup (For 2)",price:10.5,category:"Soup"},item_073:{name:"Chicken Fried Rice (Pt)",price:6.75,category:"Fried Rice"},item_074:{name:"Chicken Fried Rice (Qt)",price:9.75,category:"Fried Rice"},item_075:{name:"Pork Fried Rice (Pt)",price:6.75,category:"Fried Rice"},item_076:{name:"Pork Fried Rice (Qt)",price:9.75,category:"Fried Rice"},item_077:{name:"Beef Fried Rice (Pt)",price:7.15,category:"Fried Rice"},item_078:{name:"Beef Fried Rice (Qt)",price:10.25,category:"Fried Rice"},item_079:{name:"Shrimp Fried Rice (Pt)",price:7.15,category:"Fried Rice"},item_080:{name:"Shrimp Fried Rice (Qt)",price:10.25,category:"Fried Rice"},item_081:{name:"Vegetable Fried Rice (Pt)",price:6.25,category:"Fried Rice"},item_082:{name:"Vegetable Fried Rice (Qt)",price:9.75,category:"Fried Rice"},item_083:{name:"House Special Fried Rice (Pt)",price:8.5,category:"Fried Rice"},item_084:{name:"House Special Fried Rice (Qt)",price:11.95,category:"Fried Rice"},item_085:{name:"White Meat Chicken Lo Mein (Pt)",price:7.25,category:"Lo Mein"},item_086:{name:"White Meat Chicken Lo Mein (Qt)",price:10.95,category:"Lo Mein"},item_087:{name:"Pork Lo Mein (Pt)",price:7.25,category:"Lo Mein"},item_088:{name:"Pork Lo Mein (Qt)",price:10.95,category:"Lo Mein"},item_089:{name:"Beef Lo Mein (Pt)",price:8,category:"Lo Mein"},item_090:{name:"Beef Lo Mein (Qt)",price:11.95,category:"Lo Mein"},item_091:{name:"Shrimp Lo Mein (Pt)",price:8,category:"Lo Mein"},item_092:{name:"Shrimp Lo Mein (Qt)",price:11.95,category:"Lo Mein"},item_093:{name:"Vegetable Lo Mein (Pt)",price:6.75,category:"Lo Mein"},item_094:{name:"Vegetable Lo Mein (Qt)",price:10.25,category:"Lo Mein"},item_095:{name:"House Special Lo Mein (Pt)",price:8.5,category:"Lo Mein"},item_096:{name:"House Special Lo Mein (Qt)",price:12.75,category:"Lo Mein"}},C=null;async function N(e){let t=await fetch("/api/responses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,parallel_tool_calls:!1})});return t.ok?await t.json():(console.warn("Server returned an error:",t),{error:"Something went wrong."})}async function k(e){var t;if(null==e?void 0:e.error)return{error:"Something went wrong."};let r=(null!=(t=e.output)?t:[]).filter(e=>"function_call"===e.type);if(0===r.length)return"no function call";for(let e of(console.log("function calls"),console.log(r),r)){let t=e.name,r=JSON.parse(e.arguments||"{}");switch(t){case"fetchMenuItem":return P(r);case"sumOrderTool":return E();case"updateOrder":return A(r);default:return{result:!0}}}}let E=()=>C?C.ordered_items.reduce((e,t)=>e+t.item_price*t.quantity,0):0,T=e=>{(C=null!=C?C:{ordered_items:[],delivery_address:""}).delivery_address=e.delivery_address},j=e=>{for(let{itemNumber:t,quantity:r,specialInstruction:n}of(C=null!=C?C:{ordered_items:[],delivery_address:""},e.itemsToAdd)){let e=_[t];if(!e){console.warn('Menu item "'.concat(t,'" not found; skipping'));continue}let o={index:C.ordered_items.length+1,item_number:t,item_name:e.name,item_price:e.price,quantity:r,...n&&{special_instruction:n}};C.ordered_items.push(o)}return console.log("Updated order:",C),C},A=e=>{if(!C)throw Error("No current order to update.");let{index:t,itemNumber:r,quantity:n,specialInstruction:o}=e,i=C.ordered_items.find(e=>e.index===t);if(!i)throw Error("Order item with index ".concat(t," not found."));if(r){let e=_[r];if(!e)throw Error('Menu item "'.concat(r,'" not found.'));i.item_number=r,i.item_name=e.name,i.item_price=e.price}return void 0!==n&&(i.quantity=n),void 0!==o&&(i.special_instruction=o),C},P=e=>e.itemNumbers.map(e=>{let t=_[e];if(!t)throw Error('Menu item with key "'.concat(e,'" not found.'));return{itemNumber:e,...t}}),O=()=>C=null!=C?C:{ordered_items:[],delivery_address:""},I=()=>{(C=null!=C?C:{ordered_items:[],delivery_address:""}).ordered_items=C.ordered_items.filter(e=>e.quantity>0)},R={type:"function",name:"updateOrder",description:"Update specified item in the current order",parameters:{type:"object",properties:{index:{type:"number",description:"the item index in the current order"},itemNumber:{type:"string",description:"The item number of the item from the menu"},quantity:{type:"number",description:"The quantity number of the ordered item"},specialInstruction:{type:"string",description:"The special instruction of this item"}},required:["index","itemNumber","quantity","specialInstruction"],additionalProperties:!1}},L={type:"function",name:"fetchMenuItem",description:"Fetch one or more menu items from the restaurantMenu by their item numbers",parameters:{type:"object",properties:{itemNumbers:{type:"array",description:'The list of menu item keys to fetch (e.g. ["item_001", "item_002"])',items:{type:"string",description:"A single menu item key"}}},required:["itemNumbers"],additionalProperties:!1}},D=(0,y.z6)({name:"sumOrder",description:"Calculate the sum of price of the current order",parameters:{type:"object",properties:{sum:{type:"string",description:"A optional string of order to let the tool start the sum action"}},required:[],additionalProperties:!1},execute:async(e,t)=>{console.log("Sum up current Order: tool call input and details"),console.log(e),console.log(t);let r=E();console.log("currentorder total dollar:"),console.log(r);let n={orderItem:C,totalPrice:r};return console.log(n),n}}),M=(0,y.z6)({name:"printOrder",description:"Print order details with the items and delivery instruction.",parameters:{type:"object",properties:{delivery_address:{type:"string",description:"The delivery street address, with zip code and unit number when appropriate. Also with customer's name"}},required:["delivery_address"],additionalProperties:!1},execute:async(e,t)=>{console.log("print order, input and details"),console.log(e),T(e),I(),console.log(t),console.log("currentorder: "),console.log(C)}}),F=(0,y.z6)({name:"lookupMenu",description:"Look up the items customer ordered and find the best matched items from the menu.\n    If there is no reasonable match in the menu, respond with empty list.\n    ",parameters:{type:"object",properties:{orderedItems:{type:"array",description:"The list of items to add to the order",items:{type:"string",description:"The description of customer ordered item (one item at a time) and quantity, special instructions"}}},required:["orderedItems"],additionalProperties:!1},execute:async(e,t)=>{var r;let{orderedItems:n}=e,o={model:"gpt-4.1",input:[{type:"message",role:"system",content:"\n              Look up the item customer ordered in the menu and find the best matched items from the menu.\n              For each ordered item, do not return more than 5 matches.\n              If there is no reasonable match in the menu, respond with empty list.\n            "},{type:"message",role:"system",content:"==== Restaurant Menu ====\n            ".concat(JSON.stringify(_,null,2),"\n            ")},{type:"message",role:"user",content:"==== Ordered Items ====\n            ".concat(JSON.stringify(n,null,2))}],tools:[L]};console.log("!!!@@@@@@@!!!process look up menu tool:-------"),console.log(o);let i=await N(o),a=await k(i);if(console.log(t),console.log("processlook up menu response:"),console.log(a),console.log(i.output_text),a.error)return a.error;let s=Array.isArray(a)&&a.length>0?JSON.stringify(a,null,2):"nothing found",c=(null==(r=i.output_text)?void 0:r.trim())?" Other comments from lookupMenuTool: ".concat(i.output_text.trim()):"";return console.log(s),console.log(c),"Best matched item(s):".concat(s,".").concat(c)}}),z=(0,y.z6)({name:"processCustomerAddItem",description:"Add specified item or items to the current order",parameters:{type:"object",properties:{itemsToAdd:{type:"array",description:"The list of items to add to the order",items:{type:"object",properties:{itemNumber:{type:"string",description:"The item number of the item from the menu, in its original format, for example, item_004"},quantity:{type:"number",description:"The quantity number of the ordered item"},specialInstruction:{type:"string",description:"The special instruction of this item"}},required:["itemNumber","quantity"],additionalProperties:!1}}},required:["itemsToAdd"],additionalProperties:!1},execute:async(e,t)=>{var r;let n=null==t||null==(r=t.context)?void 0:r.addTranscriptBreadcrumb;console.log("~~~~~~~~~~~adding item tool call input:"),console.log(e),console.log("~~~~~~~~~~~add to item tool details"),console.log(t),j(e);let o=O(),i={"Current Order":o};return console.log("current order after adding item"),console.log(i),n&&n("Current Order:",o),"".concat(JSON.stringify(i,null,2))}}),B=(0,y.z6)({name:"processCustomerUpdateItem",description:"Look up the item customer ordered in the current order and find the best matched items from the order, \n    and call the updateOrder tool with the updated item details, if any, to add the item.\n    If there is no reasonable match in the order, respond 'item not found in current order'.\n    ",parameters:{type:"object",properties:{updateInstruction:{type:"string",description:"The update instruction of the ordered item"}},required:["index","itemNumber","quantity","specialInstruction"],additionalProperties:!1},execute:async(e,t)=>{let{updateInstruction:r}=e,n={model:"gpt-4.1",input:[{type:"message",role:"system",content:"Based on the update instruction, find the corresponding item in the current order, then call the updateItemTool with the updated item details"},{type:"message",role:"user",content:"==== current order ====\n            ".concat(JSON.stringify(C,null,2),"\n            ")},{type:"message",role:"user",content:r}],tools:[R]};console.log("!!!@@@@@@@!!!process customer UPDATE item log:-------"),console.log(n);let o=await N(n);return console.log(o),k(o),console.log(t),o.text}}),U=[new y.lo({name:"chatAgent",voice:"sage",instructions:'\nRole Description\nYou are a helpful junior phone agent for Hunan Wok, a Chinese restaurant.\nYour primary task is to take customer phone orders, confirm all details, and collect delivery information clearly and accurately.\nYou must not handle any non-order-related requests. You should speak the same language as the customer.\n\nGeneral Instructions\nKeep conversations short, polite, and efficient.\n\nUse simple, natural language. When calling tools and expect taking more than 1 second, politely ask customer to wait. For example: "Just One moment".\n\nAlways confirm details to prevent mistakes.\n\nHandle interruptions or corrections naturally.\n\nNever guess—ask for clarification if uncertain.\n\nAlways use the processCustomerAddItem tool to add items to an order, use processCustomerUpdateItem Tool to update or delete items.\n\nIf the customer lists multiple items at once, call processCustomerAddItem only once with an array of all item descriptions. Example: [\'beef with broccoli\', \'chicken fried rice\']\n\nDo not call the tool multiple times per round; merge items into a single call where possible.\n\nThe tool will validate items against the menu. If an item is invalid, clarify with the customer and add it after confirmation. Avoid adding duplicate items.\n\nWhen the customer asks to update or delete (delete can be done by setting quantity to 0) an item, always use the processCustomerUpdateItem tool.\n\nOnce the order is complete, always call sumOrderTool to get the total price and the full order, confirm the full order and total price with the customer.\n\nAt the very end, after confirming the order and delivery details, always call printOrder to finalize and print the order.\n\nCall Flow\n1. Greeting\nGreet the customer with the restaurant name.\n\nAsk whether the order is for pickup or delivery.\n\nExample: "Hi, this is Hunan Wok. Is this for pickup or delivery?"\n\n2. Collect Delivery Information (if applicable)\nIf delivery:\n\nAsk for the delivery address and name.\n\nExample: "What\'s the delivery address and name, please?"\n\n3. Take the Order\nListen carefully for multiple items; split them as needed.\n\nFor each item:\n\nALWAYS call the lookupMenuTool to validate against the menu.\n\nTHIS IS IMPORTANT: ALWAYS call the lookupMenuTool to validate against the menu, DO NOT promise or suggest any item that is not in the menu.\n\nIf the item is not found from the menu, do not make up any options for suggestion. Only ask customer with the options from the lookupMenuTool.\n\nAsk for options (rice type, size) if not specified.\n\nIf customer does not mention quantity, always assume it is one order. Confirm quantity if unclear.\n\nUse processCustomerAddItem to add the item(s) to the order. Validate the item is successfully added to item by looking at the item processCustomerAddItem returned. \n\nExample: "One General Tso\'s Chicken combo—got it. With white rice of fried rice?"\n\n"Sorry, we don\'t have pork fried mei fun on our menu. Would you like something else?\n\n4. Handle Clarifications\nIf the request is incomplete or ambiguous:\n\nAsk politely.\n\nUse processCustomerUpdateItemTool to update the item that is already in current order. \n\nDo not use processCustomerAddItem to update item to avoid duplicate.\n\nExamples:\n\n"Did you want that with white rice or fried rice?"\n\n"Sorry, could you repeat that item?"\n\n5. Ask if Anything Else\nAfter confirming items, ask if the customer wants to add more.\n\nExample: “Anything else you\'d like to add?”\n\n6. Confirm the Order and Price\nCall sumOrderTool to get the total price and the full order.\n\nRead back the entire order and confirm both items and total price. Also ask customer\'s name to appear in the order delivery address\n\nExample: "So that\'s one General Tso\'s Chicken combo with fried rice, one egg roll, and one wonton soup. That\'ll be $13.75. Is that correct?"\n\n7. Close the Call\nAlways call the printOrder tool to finalize the order. (This important because otherwise this order will not be created!!!\nSo you have to call the printOrder tool to actually create this order) \n\nSay thank you and provide a polite closing.\n\nExample:\n\nCall printOrder Tool.\n\n"Your order is confirmed and successfully submitted. Thanks and have a good day!"\n',tools:[F,z,B,M,D]})],G={chatSupervisor:U};function H(e,t,r){for(let n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}async function q(e){let t=await e.arrayBuffer(),r=new AudioContext,n=await r.decodeAudioData(t),o=n.numberOfChannels,i=n.length,a=new Float32Array(i);for(let e=0;e<o;e++){let t=n.getChannelData(e);for(let e=0;e<i;e++)a[e]+=t[e]}for(let e=0;e<i;e++)a[e]/=o;return new Blob([function(e,t){let r=new ArrayBuffer(44+2*e.length),n=new DataView(r);H(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),H(n,8,"WAVE"),H(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,t,!0),n.setUint32(28,2*t,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),H(n,36,"data"),n.setUint32(40,2*e.length,!0);var o=44;for(let t=0;t<e.length;t++,o+=2){let r=Math.max(-1,Math.min(1,e[t]));n.setInt16(o,r<0?32768*r:32767*r,!0)}return r}(a,n.sampleRate)],{type:"audio/wav"})}let W=function(){let e=(0,o.useRef)(null),t=(0,o.useRef)([]);return{startRecording:async r=>{let n;try{n=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){console.error("Error getting microphone stream:",e),n=new MediaStream}let o=new AudioContext,i=o.createMediaStreamDestination();try{o.createMediaStreamSource(r).connect(i)}catch(e){console.error("Error connecting remote stream to the audio context:",e)}try{o.createMediaStreamSource(n).connect(i)}catch(e){console.error("Error connecting microphone stream to the audio context:",e)}try{let r=new MediaRecorder(i.stream,{mimeType:"audio/webm"});r.ondataavailable=e=>{e.data&&e.data.size>0&&t.current.push(e.data)},r.start(),e.current=r}catch(e){console.error("Error starting MediaRecorder with combined stream:",e)}},stopRecording:()=>{e.current&&(e.current.requestData(),e.current.stop(),e.current=null)},downloadRecording:async()=>{if(e.current&&"recording"===e.current.state&&(e.current.requestData(),await new Promise(e=>setTimeout(e,100))),0===t.current.length)return void console.warn("No recorded chunks found to download.");let r=new Blob(t.current,{type:"audio/webm"});try{let e=await q(r),t=URL.createObjectURL(e),n=new Date().toISOString().replace(/[:.]/g,"-"),o=document.createElement("a");o.style.display="none",o.href=t,o.download="realtime_agents_audio_".concat(n,".wav"),document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(t),100)}catch(e){console.error("Error converting recording to WAV:",e)}}}},V={chatSupervisor:U},Q=function(){let e=(0,i.useSearchParams)(),t=e.get("codec")||"opus",{addTranscriptMessage:r,addTranscriptBreadcrumb:c}=(0,l.c)(),{logClientEvent:d,logServerEvent:u}=(0,p._)(),[x,v]=(0,o.useState)(""),[b,S]=(0,o.useState)(null),_=(0,o.useRef)(null),C=(0,o.useRef)(!1),N=o.useMemo(()=>{let e=document.createElement("audio");return e.autoplay=!0,e.style.display="none",document.body.appendChild(e),e},[]);(0,o.useEffect)(()=>{N&&!_.current&&(_.current=N)},[N]);let{connect:k,disconnect:E,sendUserText:T,sendEvent:j,interrupt:A,mute:P}=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,o.useRef)(null),[n,i]=(0,o.useState)("DISCONNECTED"),{logClientEvent:a}=(0,p._)(),s=(0,o.useCallback)(e=>{var r;i(e),null==(r=t.onConnectionChange)||r.call(t,e),a({},e)},[t]),{logServerEvent:c}=(0,p._)(),l=f().current;function d(e){switch(e.type){case"conversation.item.input_audio_transcription.completed":case"response.audio_transcript.done":l.handleTranscriptionCompleted(e);break;case"response.audio_transcript.delta":l.handleTranscriptionDelta(e);break;default:c(e)}}let u=(0,o.useRef)((null!=(e=new URLSearchParams(window.location.search).get("codec"))?e:"opus").toLowerCase()),m=(0,o.useCallback)(e=>(function(e,t){try{var r,n;let o=null==(r=(n=RTCRtpSender).getCapabilities)?void 0:r.call(n,"audio");if(!o)return;let i=o.codecs.find(e=>e.mimeType.toLowerCase()==="audio/".concat(t.toLowerCase()));if(!i)return;e.getTransceivers().filter(e=>{var t;return e.sender&&(null==(t=e.sender.track)?void 0:t.kind)==="audio"}).forEach(e=>e.setCodecPreferences([i]))}catch(e){console.error("[codecUtils] applyCodecPreferences error",e)}})(e,u.current),[]),h=e=>{var r;let n=e.context.history,o=n[n.length-1].name.split("transfer_to_")[1];null==(r=t.onAgentHandoff)||r.call(t,o)};(0,o.useEffect)(()=>{r.current&&(r.current.on("error",function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];c({type:"error",message:t[0]})}),r.current.on("agent_handoff",h),r.current.on("agent_tool_start",l.handleAgentToolStart),r.current.on("agent_tool_end",l.handleAgentToolEnd),r.current.on("history_updated",l.handleHistoryUpdated),r.current.on("history_added",l.handleHistoryAdded),r.current.on("guardrail_tripped",l.handleGuardrailTripped),r.current.on("transport_event",d))},[r.current]);let g=(0,o.useCallback)(async e=>{let{getEphemeralKey:t,initialAgents:n,audioElement:o,extraContext:i,outputGuardrails:a}=e;if(r.current)return;s("CONNECTING");let c=await t(),l=n[0],d=function(e){let t="pcm16";{let r=e.toLowerCase();"pcmu"===r?t="g711_ulaw":"pcma"===r&&(t="g711_alaw")}return t}(u.current);r.current=new y.Ko(l,{transport:new y.FP({audioElement:o,changePeerConnection:async e=>(m(e),e)}),model:"gpt-4o-realtime-preview-2025-06-03",config:{inputAudioFormat:d,outputAudioFormat:d,inputAudioTranscription:{model:"gpt-4o-mini-transcribe"}},outputGuardrails:null!=a?a:[],context:null!=i?i:{}}),await r.current.connect({apiKey:c}),s("CONNECTED")},[t,s]),x=(0,o.useCallback)(()=>{var e;null==(e=r.current)||e.close(),r.current=null,s("DISCONNECTED")},[s]),v=()=>{if(!r.current)throw Error("RealtimeSession not connected")},b=(0,o.useCallback)(()=>{var e;null==(e=r.current)||e.interrupt()},[]),S=(0,o.useCallback)(e=>{v(),r.current.sendMessage(e)},[]),w=(0,o.useCallback)(e=>{var t;null==(t=r.current)||t.transport.sendEvent(e)},[]),_=(0,o.useCallback)(e=>{var t;null==(t=r.current)||t.mute(e)},[]);return{status:n,connect:g,disconnect:x,sendUserText:S,sendEvent:w,mute:_,pushToTalkStart:(0,o.useCallback)(()=>{r.current&&r.current.transport.sendEvent({type:"input_audio_buffer.clear"})},[]),pushToTalkStop:(0,o.useCallback)(()=>{r.current&&(r.current.transport.sendEvent({type:"input_audio_buffer.commit"}),r.current.transport.sendEvent({type:"response.create"}))},[]),interrupt:b}}({onConnectionChange:e=>I(e),onAgentHandoff:e=>{C.current=!0,v(e)}}),[O,I]=(0,o.useState)("DISCONNECTED"),[R,L]=(0,o.useState)(!0),[D,M]=(0,o.useState)(""),[F,z]=(0,o.useState)(!1),[B,U]=(0,o.useState)(!1),[H,q]=(0,o.useState)(()=>{let e=localStorage.getItem("audioPlaybackEnabled");return!e||"true"===e}),{startRecording:Q,stopRecording:J,downloadRecording:K}=W(),Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{j(e),d(e,t)}catch(e){console.error("Failed to send via SDK",e)}};f(),(0,o.useEffect)(()=>{var t;let r=e.get("agentConfig");if(!r||!G[r]){r="chatSupervisor";let e=new URL(window.location.toString());e.searchParams.set("agentConfig",r),window.location.replace(e.toString());return}let n=G[r];v((null==(t=n[0])?void 0:t.name)||""),S(n)},[e]),(0,o.useEffect)(()=>{x&&"DISCONNECTED"===O&&$()},[x]),(0,o.useEffect)(()=>{if("CONNECTED"===O&&b&&x){let e=b.find(e=>e.name===x);c("Agent: ".concat(x),e),et(!C.current),C.current=!1}},[b,x,O]),(0,o.useEffect)(()=>{"CONNECTED"===O&&et()},[F]);let X=async()=>{var e;d({url:"/session"},"fetch_session_token_request");let t=await fetch("/api/session"),r=await t.json();return(u(r,"fetch_session_token_response"),null==(e=r.client_secret)?void 0:e.value)?r.client_secret.value:(d(r,"error.no_ephemeral_key"),console.error("No ephemeral key provided by the server"),I("DISCONNECTED"),null)},$=async()=>{let t=e.get("agentConfig")||"default";if(V[t]){if("DISCONNECTED"!==O)return;I("CONNECTING");try{var r;let e=await X();if(!e)return;let n=[...V[t]],o=n.findIndex(e=>e.name===x);if(o>0){let[e]=n.splice(o,1);n.unshift(e)}let i=(r="Hunanwok",{name:"moderation_guardrail",async execute(e){let{agentOutput:t}=e;try{let e=await w(t,r);return{tripwireTriggered:"NONE"!==e.moderationCategory,outputInfo:e}}catch(e){return{tripwireTriggered:!1,outputInfo:{error:"guardrail_failed"}}}}});await k({getEphemeralKey:async()=>e,initialAgents:n,audioElement:N,outputGuardrails:[i],extraContext:{addTranscriptBreadcrumb:c}})}catch(e){console.error("Error connecting via SDK:",e),I("DISCONNECTED")}return}},Z=()=>{E(),I("DISCONNECTED"),U(!1)},ee=e=>{let t=(0,a.A)().slice(0,32);r(t,"user",e,!0),Y({type:"conversation.item.create",item:{id:t,type:"message",role:"user",content:[{type:"input_text",text:e}]}}),Y({type:"response.create"},"(simulated user text message)")},et=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];j({type:"session.update",session:{turn_detection:F?null:{type:"server_vad",threshold:.9,prefix_padding_ms:300,silence_duration_ms:500,create_response:!0}}}),e&&ee("hi")};(0,o.useEffect)(()=>{let e=localStorage.getItem("pushToTalkUI");e&&z("true"===e);let t=localStorage.getItem("logsExpanded");t&&L("true"===t);let r=localStorage.getItem("audioPlaybackEnabled");r&&q("true"===r)},[]),(0,o.useEffect)(()=>{localStorage.setItem("pushToTalkUI",F.toString())},[F]),(0,o.useEffect)(()=>{localStorage.setItem("logsExpanded",R.toString())},[R]),(0,o.useEffect)(()=>{localStorage.setItem("audioPlaybackEnabled",H.toString())},[H]),(0,o.useEffect)(()=>{_.current&&(H?(_.current.muted=!1,_.current.play().catch(e=>{console.warn("Autoplay may be blocked by browser:",e)})):(_.current.muted=!0,_.current.pause()));try{P(!H)}catch(e){console.warn("Failed to toggle SDK mute",e)}},[H]),(0,o.useEffect)(()=>{if("CONNECTED"===O)try{P(!H)}catch(e){console.warn("mute sync after connect failed",e)}},[O,H]),(0,o.useEffect)(()=>{var e;return"CONNECTED"===O&&(null==(e=_.current)?void 0:e.srcObject)&&Q(_.current.srcObject),()=>{J()}},[O]);let er=e.get("agentConfig")||"default";return(0,n.jsxs)("div",{className:"text-base flex flex-col h-screen bg-gray-100 text-gray-800 relative",children:[(0,n.jsxs)("div",{className:"p-5 text-lg font-semibold flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>window.location.reload(),children:[(0,n.jsx)("div",{children:(0,n.jsx)(s.default,{src:"/openai-logomark.svg",alt:"OpenAI Logo",width:20,height:20,className:"mr-2"})}),(0,n.jsxs)("div",{children:["Realtime API ",(0,n.jsx)("span",{className:"text-gray-500",children:"Agents"})]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("label",{className:"flex items-center text-base gap-1 mr-2 font-medium",children:"Scenario"}),(0,n.jsxs)("div",{className:"relative inline-block",children:[(0,n.jsx)("select",{value:er,onChange:e=>{let t=e.target.value,r=new URL(window.location.toString());r.searchParams.set("agentConfig",t),window.location.replace(r.toString())},className:"appearance-none border border-gray-300 rounded-lg text-base px-2 py-1 pr-8 cursor-pointer font-normal focus:outline-none",children:Object.keys(G).map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-600",children:(0,n.jsx)("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 10.44l3.71-3.21a.75.75 0 111.04 1.08l-4.25 3.65a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z",clipRule:"evenodd"})})})]}),er&&(0,n.jsxs)("div",{className:"flex items-center ml-6",children:[(0,n.jsx)("label",{className:"flex items-center text-base gap-1 mr-2 font-medium",children:"Agent"}),(0,n.jsxs)("div",{className:"relative inline-block",children:[(0,n.jsx)("select",{value:x,onChange:e=>{let t=e.target.value;Z(),v(t)},className:"appearance-none border border-gray-300 rounded-lg text-base px-2 py-1 pr-8 cursor-pointer font-normal focus:outline-none",children:null==b?void 0:b.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.name))}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-600",children:(0,n.jsx)("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 10.44l3.71-3.21a.75.75 0 111.04 1.08l-4.25 3.65a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z",clipRule:"evenodd"})})})]})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-1 gap-2 px-2 overflow-hidden relative",children:[(0,n.jsx)(m,{userText:D,setUserText:M,onSendMessage:()=>{if(D.trim()){A();try{T(D.trim())}catch(e){console.error("Failed to send via SDK",e)}M("")}},downloadRecording:K,canSend:"CONNECTED"===O}),(0,n.jsx)(h,{isExpanded:R})]}),(0,n.jsx)(g,{sessionStatus:O,onToggleConnection:()=>{"CONNECTED"===O||"CONNECTING"===O?(Z(),I("DISCONNECTED")):$()},isPTTActive:F,setIsPTTActive:z,isPTTUserSpeaking:B,handleTalkButtonDown:()=>{"CONNECTED"===O&&(A(),U(!0),Y({type:"input_audio_buffer.clear"},"clear PTT buffer"))},handleTalkButtonUp:()=>{"CONNECTED"===O&&B&&(U(!1),Y({type:"input_audio_buffer.commit"},"commit PTT"),Y({type:"response.create"},"trigger response PTT"))},isEventsPaneExpanded:R,setIsEventsPaneExpanded:L,isAudioPlaybackEnabled:H,setIsAudioPlaybackEnabled:q,codec:t,onCodecChange:e=>{let t=new URL(window.location.toString());t.searchParams.set("codec",e),window.location.replace(t.toString())}})]})}},9271:(e,t,r)=>{"use strict";r.d(t,{TranscriptProvider:()=>s,c:()=>c});var n=r(5155),o=r(2115),i=r(1368);let a=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[r,s]=(0,o.useState)([]);function c(){let e=new Date,t=e.toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),r=e.getMilliseconds().toString().padStart(3,"0");return"".concat(t,".").concat(r)}return(0,n.jsx)(a.Provider,{value:{transcriptItems:r,addTranscriptMessage:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s(o=>o.some(t=>t.itemId===e&&"MESSAGE"===t.type)?(console.warn("[addTranscriptMessage] skipping; message already exists for itemId=".concat(e,", role=").concat(t,", text=").concat(r)),o):[...o,{itemId:e,type:"MESSAGE",role:t,title:r,expanded:!1,timestamp:c(),createdAtMs:Date.now(),status:"IN_PROGRESS",isHidden:n}])},updateTranscriptMessage:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(n=>n.map(n=>{if(n.itemId===e&&"MESSAGE"===n.type){var o;return{...n,title:r?(null!=(o=n.title)?o:"")+t:t}}return n}))},addTranscriptBreadcrumb:(e,t)=>{s(r=>[...r,{itemId:"breadcrumb-".concat((0,i.A)()),type:"BREADCRUMB",title:e,data:t,expanded:!1,timestamp:c(),createdAtMs:Date.now(),status:"DONE",isHidden:!1}])},toggleTranscriptItemExpand:e=>{s(t=>t.map(t=>t.itemId===e?{...t,expanded:!t.expanded}:t))},updateTranscriptItem:(e,t)=>{s(r=>r.map(r=>r.itemId===e?{...r,...t}:r))}},children:t})};function c(){let e=(0,o.useContext)(a);if(!e)throw Error("useTranscript must be used within a TranscriptProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[105,652,441,684,358],()=>t(2518)),_N_E=e.O()}]);